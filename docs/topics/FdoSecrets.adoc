= KeePassXC - Secret Service Integration
include::.sharedheader[]
:imagesdir: ../images

// tag::content[]
== freedesktop.org Secret Service API
The freedesktop.org specification
https://www.freedesktop.org/wiki/Specifications/secret-storage-spec/[Secret Service]
is a D-Bus API that allows applications to store and query secrets.
Examples of applications consuming the API are Chrome, Firefox, or any other applications making use of the `libsecret` library.

KeePassXC Secret Service integration is built to securely expose secrets stored in your KeePassXC database over the Secret Service API, such that more applications can directly store/retrieve them safely without the need to configure any separate secret service software, making it easier to manager all your secret data in one place.

Note that this is a Linux-only feature, and the plugin will not be available on Windows or MacOS.

== Setting up Secret Service Integration
By default the Secret Service integration plugin is disabled.
To enable integration, follow the steps below to access the settings:

1. Select _Tools > Settings_ from the menu
2. Select _Secret Service Integration_ category on the left sidebar

.Secret Service Integration Application Settings Page
image::fdosecrets_application_settings.png[]

On the settings page you can enable the plugin by checking _Enable KeepassXC Freedesktop.org Secret Service integration_.
After applying the settings and coming back, the rest of the settings will be enabled for further customization.

Note that by default KeePassXC will not expose any database or password entries after enabling the plugin, as a security precaution.
Please refer to the next section for how to configure an exposed group in your database.

=== Check Existing Secret Services
You may see a warning banner shown on the settings page and are unable to enable the plugin.

.Secret Service Integration Warning on Application Settings Page
image::fdosecrets_application_settings_warning.png[]

This is because another secret service is already running. It has to be stopped before KeePassXC can take over and provide the Secret Service API to other applications.

The warning message should tell you the running service's PID and executable path.
You can use this to identify and disable the offending service. This most likely to be GNOME Keyring if you are using the GNOME desktop environment.
However every Linux distribution is configured differently, so there is no general guide how to properly do it yourself. The following provides some tips using GNOME Keyring as an example.

==== Disable GNOME Keyring

`gnome-keyring-daemon` is the actual process name of GNOME Keyring. It may be started in the following ways:

 * PAM may auto start the service as a step of user login authentication (`pam_gnome_keyring.so`)
 * The service may be auto-started as a XDG autostart application
 * The service may be auto-started by D-Bus daemon as the default provider for `org.freedesktop.secrets`

== Expose a Database Group

== Test the Setup
`libsecret` provides a handy command line tool `secret-tool` that can store and retrieve passwords from the secret service. We will use it to verify our setup.

To store a password

    $ secret-tool store --label='My Password' key1 value1 key2 value2
    Password:

Note: the password is not echoed.

To lookup the just saved password

    $ secret-tool lookup key1 value1 key2 value2
    super-secret123

To delete it

    $ secret-tool clear key1 value1 key2 value2

=== Understand the Mapping between Secret Service and KeePassXC Entries

Label is the entry title.

Attribute key-value pairs are saved in _Advanced > Additional Attributes_.

KeePassXC also automatically add some readonly attributes:

.Additional readonly attributes
|===
|Key |Value

|Title |The entry title
|UserName |The entry user name
|URL |The entry URL
|Notes |The entry notes
|===

== Other Configurations

=== General

==== Show notification when passwords are retrieved by clients
If enabled, a desktop notification is shown every time a password is requested by clients.

==== Confirm when passwords are retrieved by clients
Show a confirmation dialog for each password requested by clients. You can choose individually which password to allow access.

WARNING: the client name is provided for information purpose only. It is not suitable to identify an application, and can be forged by malicious applications.

==== Confirm when clients request entry deletion
Show a deletion confirmation dialog when entries are deleted by clients via the API, similar to the one shown when deleting entries directly in KeePassXC UI.

Note that if _Security > Conveninece > Move entries to recycle bin without confirmation_ is checked, this option has no effect.

=== List of Current Authorized Applications
Show a list of all currently connected applications.

.List of current authorized applications
image::fdosecrets_authorized_applications.png
// end::content[]
